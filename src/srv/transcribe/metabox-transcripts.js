!function(){"use strict";!function e(){if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);function t(e){for(var t=e;t.tagName&&!t.classList.contains("webcomic-transcript-form");)t=t.parentNode;if(t.tagName&&t.classList.contains("webcomic-transcript-form")){var r=t.querySelector(".webcomic-media");r.style.display&&"block"!==r.style.display?r.style.display=null:r.style.display="none"}}function r(e,t){for(var r=e;r.tagName&&!r.classList.contains("inside");)r=r.parentNode;if(r.tagName&&r.classList.contains("inside")&&(r=r.querySelector("fieldset")))return n(r.parentNode,e,t);var o=new FormData,c=new XMLHttpRequest;o.append("action","webcomic_transcribe_form"),o.append("parent",document.querySelector("#post_ID").value),o.append("post",t),c.onreadystatechange=function(){if(4===c.readyState){var r,o=document.createElement("div");o.innerHTML=c.responseText,(r=o).querySelector(".button-primary").addEventListener("click",function(e){var t,o,c,i,s;e.preventDefault(),t=r,o=new FormData,c=new XMLHttpRequest,i=t.querySelector("[data-id]").getAttribute("data-id"),s=function(e){for(var t=e.querySelectorAll('[type="checkbox"]'),r=[],n=0;n<t.length;n++)t[n].checked&&r.push(t[n].value);return r}(t),o.append("action","webcomic_transcribe_submit"),o.append("post",i),o.append("post_parent",document.querySelector("#post_ID").value),o.append("post_content",t.querySelector("textarea").value),o.append("post_status",t.querySelector(".status").value),o.append("post_languages",s),o.append("Mgsisk\\Webcomic\\Transcribe\\MetaBoxSubmitTranscriptNonce",t.querySelector('[type="hidden"]').value),c.onreadystatechange=function(){if(4===c.readyState)if(0!==c.responseText.indexOf("ERROR")){if("0"===i){for(var e=t.parentNode;e.tagName&&!e.classList.contains("inside");)e=e.parentNode;r=e.querySelector("tbody"),o=c.responseText,s=new FormData,d=new XMLHttpRequest,s.append("action","webcomic_transcribe_row"),s.append("post",o),d.onreadystatechange=function(){if(4===d.readyState&&0!==d.responseText.indexOf("ERROR")){var e=document.createElement("tbody"),t=r.querySelector("tr:last-child");e.innerHTML=d.responseText,a(e),r.insertBefore(e.children[0],r.querySelector("tr")),t.classList.contains("none")&&r.removeChild(t)}},d.open("POST",ajaxurl),d.send(s)}var r,o,s,d;t.querySelector("textarea").classList.add("saved"),n(t)}else t.querySelector(".error").innerHTML=c.responseText},c.open("POST",ajaxurl),c.send(o)}),r.querySelector(".button-secondary").addEventListener("click",function(e){e.preventDefault(),n(r)}),r.querySelector("textarea").addEventListener("keyup",function(e){"escape"===e.key.toLowerCase()&&n(r)}),r.querySelector(".webcomic-media").addEventListener("click",function(e){for(var t=e.target;t.tagName&&!t.classList.contains("webcomic-media");)t=t.parentNode;if(t.tagName&&t.querySelector("img")){if(t.classList.contains("contain"))return t.classList.remove("contain"),void(t.style.height="auto");var r=Number(t.querySelector("img").getAttribute("width")),n=Number(t.querySelector("img").getAttribute("height")),a=r/n,o=n/2*a;t.classList.add("contain"),t.style.height="".concat(o,"px")}}),r.querySelector(".webcomic-media").style.display="none",t?(e.innerHTML='<td colspan="3"></td>',e.children[0].appendChild(o)):(e.querySelector(".add-transcript").parentNode.style.display="none",e.insertBefore(o,e.querySelector(".webcomic-transcripts"))),quicktags({id:"webcomic_transcript_content",buttons:"strong,em,link,block,del,ins,ul,ol,li,code,close"}),QTags._buttonsInit(),o.querySelector("textarea").style.height="".concat(o.querySelector("textarea").scrollHeight,"px"),o.querySelector("textarea").focus()}},c.open("POST",ajaxurl),c.send(o)}function n(e,t,n){var o=e.querySelector("textarea");if(o.classList.contains("saved")||o.value===o.defaultValue||window.confirm(webcomicTranscriptL10n.warn)){if(e.parentNode.classList.contains("inside"))return e.parentNode.querySelector(".add-transcript").parentNode.style.display=null,e.parentNode.removeChild(e),void(t&&r(t,n));var c=new FormData,i=new XMLHttpRequest;c.append("action","webcomic_transcribe_row"),c.append("post",e.querySelector("[data-id]").getAttribute("data-id")),i.onreadystatechange=function(){if(4===i.readyState)if(0!==i.responseText.indexOf("ERROR")){for(var o=document.createElement("tbody"),c=e;c.tagName&&"tr"!==c.tagName.toLowerCase();)c=c.parentNode;o.innerHTML=i.responseText,a(o),c.parentNode.replaceChild(o.children[0],c),t&&r(t,n)}else e.querySelector(".error").innerHTML=i.responseText},i.open("POST",ajaxurl),i.send(c)}}function a(e){e.querySelector(".quickedit a").addEventListener("click",function(e){e.preventDefault();var t=e.target.parentNode.parentNode.parentNode.parentNode;r(t,t.getAttribute("data-id"))}),e.querySelector(".trash a").addEventListener("click",function(e){var t,r,n,o,c;e.preventDefault(),t=e.target.parentNode.parentNode.parentNode.parentNode,r=new FormData,n=new XMLHttpRequest,o=t.getAttribute("data-id"),c=t.querySelector(".trash a").href,r.append("action","webcomic_transcribe_trash"),r.append("post",o),r.append("_wpnonce",c.substr(c.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(t.innerHTML=n.responseText,t.querySelector("a").addEventListener("click",function(e){e.preventDefault();var r=new FormData;r.append("action","webcomic_transcribe_untrash"),r.append("post",o),r.append("_wpnonce",e.target.href.substr(e.target.href.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(t.innerHTML=n.responseText,a(t)):t.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(r)})):t.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(r)})}"auto-draft"!==document.querySelector("#original_post_status")&&function(e){var n=e.querySelectorAll("tr");QTags.addButton("comic",webcomicTranscriptL10n.comic,t,"","g","",0,"webcomic_transcript_content"),function(e){if(e.querySelector(".add-transcript"))return;var t=document.createElement("p");t.innerHTML='<a href="#" class="button add-transcript">'.concat(webcomicTranscriptL10n.add,"</a>"),t.addEventListener("click",function(t){t.preventDefault(),r(e,0)}),e.insertBefore(t,e.querySelector(".webcomic-transcripts"))}(e);for(var o=0;o<n.length;o++)n[o].classList.contains("none")||a(n[o])}(document.querySelector("#Mgsisk_Webcomic_Transcribe_MetaBoxTranscripts .inside"))}()}();
