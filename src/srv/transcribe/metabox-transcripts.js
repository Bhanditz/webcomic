!function(){"use strict";!function e(){function t(e,t){for(var r=e;r.tagName&&!r.classList.contains("inside");)r=r.parentNode;if(r.tagName&&r.classList.contains("inside")&&(r=r.querySelector("fieldset")))return n(r.parentNode,e,t);var a=new FormData,c=new XMLHttpRequest;a.append("action","webcomic_transcribe_form"),a.append("parent",document.querySelector("#post_ID").value),a.append("post",t),c.onreadystatechange=function(){if(4===c.readyState){var n=document.createElement("div");n.innerHTML=c.responseText,o(n),t?(e.innerHTML='<td colspan="3"></td>',e.children[0].appendChild(n)):(e.querySelector(".add-transcript").parentNode.style.display="none",e.insertBefore(n,e.querySelector(".webcomic-transcripts"))),quicktags({id:"webcomic_transcript_content",buttons:"strong,em,link,block,del,ins,ul,ol,li,code,close"}),n.querySelector("textarea").style.height=n.querySelector("textarea").scrollHeight+"px",n.querySelector("textarea").focus()}},c.open("POST",ajaxurl),c.send(a)}function n(e,n,r){var o=e.querySelector("textarea");if(o.classList.contains("saved")||o.value===o.defaultValue||window.confirm(webcomicTranscriptL10n.warn)){if(e.parentNode.classList.contains("inside"))return e.parentNode.querySelector(".add-transcript").parentNode.style.display=null,e.parentNode.removeChild(e),void(n&&t(n,r));var c=new FormData,i=new XMLHttpRequest;c.append("action","webcomic_transcribe_row"),c.append("post",e.querySelector("[data-id]").getAttribute("data-id")),i.onreadystatechange=function(){if(4===i.readyState)if(0!==i.responseText.indexOf("ERROR")){for(var o=document.createElement("tbody"),c=e;c.tagName&&"tr"!==c.tagName.toLowerCase();)c=c.parentNode;o.innerHTML=i.responseText,a(o),c.parentNode.replaceChild(o.children[0],c),n&&t(n,r)}else e.querySelector(".error").innerHTML=i.responseText},i.open("POST",ajaxurl),i.send(c)}}function r(e,t){var n=new FormData,r=new XMLHttpRequest;n.append("action","webcomic_transcribe_row"),n.append("post",t),r.onreadystatechange=function(){if(4===r.readyState&&0!==r.responseText.indexOf("ERROR")){var t=document.createElement("tbody"),n=e.querySelector("tr:last-child");t.innerHTML=r.responseText,a(t),e.insertBefore(t.children[0],e.querySelector("tr")),n.classList.contains("none")&&e.removeChild(n)}},r.open("POST",ajaxurl),r.send(n)}function a(e){e.querySelector(".quickedit a").addEventListener("click",function(e){e.preventDefault();var n=e.target.parentNode.parentNode.parentNode.parentNode;t(n,n.getAttribute("data-id"))}),e.querySelector(".trash a").addEventListener("click",function(e){e.preventDefault(),i(e.target.parentNode.parentNode.parentNode.parentNode)})}function o(e){e.querySelector(".button-primary").addEventListener("click",function(t){t.preventDefault(),c(e)}),e.querySelector(".button-secondary").addEventListener("click",function(t){t.preventDefault(),n(e)}),e.querySelector("textarea").addEventListener("keyup",function(t){"escape"===t.key.toLowerCase()&&n(e)}),e.querySelector(".webcomic-media").addEventListener("click",function(e){for(var t=e.target;t.tagName&&!t.classList.contains("webcomic-media");)t=t.parentNode;if(t.tagName&&t.querySelector("img")){if(t.classList.contains("contain"))return t.classList.remove("contain"),void(t.style.height="auto");var n=Number(t.querySelector("img").getAttribute("width")),r=Number(t.querySelector("img").getAttribute("height")),a=r/2*(n/r);t.classList.add("contain"),t.style.height=a+"px"}}),e.querySelector(".webcomic-media").style.display="none"}function c(e){for(var t=new FormData,a=new XMLHttpRequest,o=e.querySelector("[data-id]").getAttribute("data-id"),c=e.querySelectorAll('[type="checkbox"]'),i=[],s=0;s<c.length;s++)c[s].checked&&i.push(c[s].value);t.append("action","webcomic_transcribe_submit"),t.append("post",o),t.append("post_parent",document.querySelector("#post_ID").value),t.append("post_content",e.querySelector("textarea").value),t.append("post_status",e.querySelector(".status").value),t.append("post_languages",i),t.append("Mgsisk\\Webcomic\\Transcribe\\MetaBoxSubmitTranscriptNonce",e.querySelector('[type="hidden"]').value),a.onreadystatechange=function(){if(4===a.readyState)if(0!==a.responseText.indexOf("ERROR")){if("0"===o){for(var t=e.parentNode;t.tagName&&!t.classList.contains("inside");)t=t.parentNode;r(t.querySelector("tbody"),a.responseText)}e.querySelector("textarea").classList.add("saved"),n(e)}else e.querySelector(".error").innerHTML=a.responseText},a.open("POST",ajaxurl),a.send(t)}function i(e){var t=new FormData,n=new XMLHttpRequest,r=e.getAttribute("data-id"),o=e.querySelector(".trash a").href;t.append("action","webcomic_transcribe_trash"),t.append("post",r),t.append("_wpnonce",o.substr(o.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(e.innerHTML=n.responseText,e.querySelector("a").addEventListener("click",function(t){t.preventDefault();var o=new FormData;o.append("action","webcomic_transcribe_untrash"),o.append("post",r),o.append("_wpnonce",t.target.href.substr(t.target.href.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(e.innerHTML=n.responseText,a(e)):e.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(o)})):e.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(t)}function s(e){var t=e.querySelector(".webcomic-media");t.style.display&&"block"!==t.style.display?t.style.display=null:t.style.display="none"}if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);if("auto-draft"!==document.querySelector("#original_post_status")){var d=document.querySelector("#Mgsisk_Webcomic_Transcribe_MetaBoxTranscripts .inside"),p=d.querySelectorAll("tr");!function(e){if(!e.querySelector(".add-transcript")){var n=document.createElement("p");n.innerHTML='<a href="#" class="button add-transcript">'+webcomicTranscriptL10n.add+"</a>",n.addEventListener("click",function(n){n.preventDefault(),t(e,0)}),e.insertBefore(n,e.querySelector(".webcomic-transcripts"))}}(d),QTags.addButton("comic",webcomicTranscriptL10n.comic,function(e){for(var t=e;t.tagName&&!t.classList.contains("webcomic-transcript-form");)t=t.parentNode;t.tagName&&t.classList.contains("webcomic-transcript-form")&&s(t)},"","g","",0,"webcomic_transcript_content");for(var l=0;l<p.length;l++)p[l].classList.contains("none")||a(p[l])}}()}();
