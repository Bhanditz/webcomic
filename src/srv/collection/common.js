!function(){"use strict";!function e(){function t(){var e=document.querySelector(".webcomic-infinite, [data-webcomic-infinite]");if(e){if(!e.classList.contains("loading")){var n=e.children[e.children.length-1];if(!(n&&n.getBoundingClientRect().top+window.scrollY>window.scrollY+window.innerHeight))if(e.querySelector("wbr.finished"))window.removeEventListener("scroll",t);else{e.classList.add("loading");var o=parseInt(e.children.length)+a,i=new FormData,c=new XMLHttpRequest,r=window.location.href.replace(/wi=\d+/,"wi="+o);window.location.search||(r=window.location.href+"?wi="+o),i.append("action","webcomic_infinite"),i.append("url",window.location.href),i.append("args","offset="+o+"&"+e.getAttribute("data-webcomic-infinite")),c.onreadystatechange=function(){4===c.readyState&&(e.innerHTML+=c.responseText,e.classList.remove("loading"),history.replaceState({},"",r))},c.open("POST",webcomicCommonJS.ajaxurl),c.send(i)}}}else window.removeEventListener("scroll",t)}function n(e){if(!document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"))return document.documentElement.removeEventListener("touchstart",n,!1),void document.documentElement.removeEventListener("touchend",o);c.time=(new Date).getTime(),c.posX=e.changedTouches[0].pageX,c.posY=e.changedTouches[0].pageY}function o(e){var t=document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"),a=(new Date).getTime()-c.time,r=e.changedTouches[0].pageX-c.posX,d=e.changedTouches[0].pageY-c.posY,s="Arrow";if(!t)return document.documentElement.removeEventListener("touchstart",n,!1),void document.documentElement.removeEventListener("touchend",o);a>c.maxTime||(Math.abs(r)>=c.minDistance&&Math.abs(d)<c.minDistance?(s+="Right",0<r&&(s=s.replace("Right","Left"))):Math.abs(d)>=c.minDistance&&Math.abs(r)<c.minDistance&&(s+="Down",0<d&&(s=s.replace("Down","Up"))),"Arrow"!==s&&(1<e.changedTouches.length&&(s+="Shift"),i(s,t)))}function i(e,t){var n=t.querySelector("."+{ArrowDownShift:"random-webcomic-link",ArrowLeft:"previous-webcomic-link",ArrowLeftShift:"first-webcomic-link",ArrowRight:"next-webcomic-link",ArrowRightShift:"last-webcomic-link",ArrowUpShift:"webcomic-print-link"}[e]+"[href]");e&&t&&n&&n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);var c={minDistance:150,maxTime:300,time:0,posX:0,posY:0},a=parseInt((window.location.search.match(/wi=(\d+)/)||["",0])[1]);window.addEventListener("scroll",t),document.addEventListener("change",function(e){if("select"===e.target.tagName.toLowerCase()&&e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url")){var t=e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url");t!==window.location.href&&(window.location.href=t)}}),document.addEventListener("keyup",function(e){if(!e.target.tagName.toLowerCase().match(/button|input|meter|option|output|progress|select|textarea/)){var t=document.querySelector(".webcomic-keyboard, [data-webcomic-shortcuts]"),n=e.key;t&&(e.shiftKey&&(n+="Shift"),i(n,t))}}),document.addEventListener("click",function(e){var t=document.querySelectorAll(".webcomic-dynamic");if(t.length){for(var n=e.target;n.tagName&&!n.classList.contains("webcomic-link");)n=n.parentNode;if(n.tagName){e.preventDefault();var o=new FormData,i=new XMLHttpRequest;o.append("action","webcomic_dynamic"),i.onreadystatechange=function(){if(4===i.readyState){var e=document.createElement("div");e.innerHTML=i.responseText;var o=e.querySelectorAll(".webcomic-dynamic");if(o.length)for(var c=0;c<t.length;c++)t[c].parentNode.replaceChild(o[c],t[c]);else window.location.href=n.href}},i.open("POST",n.href),i.send(o)}}}),document.documentElement.addEventListener("touchstart",n,!1),document.documentElement.addEventListener("touchend",o),window.dispatchEvent(new Event("scroll"))}()}();
