!function(){"use strict";!function e(){if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);var t={minDistance:150,maxTime:300,time:0,posX:0,posY:0},n=parseInt((window.location.search.match(/wi=(\d+)/)||["",0])[1]);function o(){var e=document.querySelector(".webcomic-infinite, [data-webcomic-infinite]");if(function(e){if(!e)return window.removeEventListener("scroll",o),!1;if(e.classList.contains("loading"))return!1;var t=e.children[e.children.length-1],n=window.scrollY+window.innerHeight,i=0;t&&(i=t.getBoundingClientRect().top+window.scrollY);if(t&&i>n)return!1;if(e.querySelector("wbr.finished"))return window.removeEventListener("scroll",o),!1;return e.classList.add("loading"),!0}(e)){var t=new FormData,i=new XMLHttpRequest,c=parseInt(e.children.length)+n,r=window.location.href.replace(/wi=\d+/,"wi=".concat(c));window.location.search||(r="".concat(window.location.href,"?wi=").concat(c)),t.append("action","webcomic_infinite"),t.append("url",window.location.href),t.append("args","offset=".concat(c,"&").concat(e.getAttribute("data-webcomic-infinite"))),i.onreadystatechange=function(){4===i.readyState&&(e.innerHTML+=i.responseText,e.classList.remove("loading"),history.replaceState({},"",r))},i.open("POST",webcomicCommonJS.ajaxurl),i.send(t)}}function i(e){if("select"===e.target.tagName.toLowerCase()&&e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url")){var t=e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url");t!==window.location.href&&(window.location.href=t)}}function c(e){if(!e.target.tagName.toLowerCase().match(/button|input|meter|option|output|progress|select|textarea/)){var t=document.querySelector(".webcomic-keyboard, [data-webcomic-shortcuts]"),n=e.key;t&&(e.shiftKey&&(n+="Shift"),s(n,t))}}function r(e){var t=document.querySelectorAll(".webcomic-dynamic");if(t.length){for(var n=e.target;n.tagName&&!n.classList.contains("webcomic-link");)n=n.parentNode;if(n.tagName){e.preventDefault();var o=new FormData,i=new XMLHttpRequest;o.append("action","webcomic_dynamic"),i.onreadystatechange=function(){if(4===i.readyState){var e=document.createElement("div");e.innerHTML=i.responseText;var o=e.querySelectorAll(".webcomic-dynamic");if(o.length)for(var c=0;c<t.length;c++)t[c].parentNode.replaceChild(o[c],t[c]);else window.location.href=n.href}},i.open("POST",n.href),i.send(o)}}}function a(e){if(!document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"))return document.documentElement.removeEventListener("touchstart",a,!1),void document.documentElement.removeEventListener("touchend",d);t.time=(new Date).getTime(),t.posX=e.changedTouches[0].pageX,t.posY=e.changedTouches[0].pageY}function d(e){var n=document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"),o=(new Date).getTime()-t.time,i=e.changedTouches[0].pageX-t.posX,c=e.changedTouches[0].pageY-t.posY;if(!n)return document.documentElement.removeEventListener("touchstart",a,!1),void document.documentElement.removeEventListener("touchend",d);if(!(o>t.maxTime)){var r=function(e,n,o){var i="Arrow";Math.abs(n)>=t.minDistance&&Math.abs(o)<t.minDistance?(i+="Right",0<n&&(i=i.replace("Right","Left"))):Math.abs(o)>=t.minDistance&&Math.abs(n)<t.minDistance&&(i+="Down",0<o&&(i=i.replace("Down","Up")));1<e.changedTouches.length&&(i+="Shift");return i}(e,i,c);r.replace(/^Arrow(Shift)?$/,"")&&s(r,n)}}function s(e,t){var n=t.querySelector(".".concat({ArrowDownShift:"random-webcomic-link",ArrowLeft:"previous-webcomic-link",ArrowLeftShift:"first-webcomic-link",ArrowRight:"next-webcomic-link",ArrowRightShift:"last-webcomic-link",ArrowUpShift:"webcomic-print-link"}[e],"[href]"));e&&t&&n&&n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}window.addEventListener("scroll",o),document.addEventListener("change",i),document.addEventListener("keyup",c),document.addEventListener("click",r),document.documentElement.addEventListener("touchstart",a,!1),document.documentElement.addEventListener("touchend",d),window.dispatchEvent(new Event("scroll"))}()}();
