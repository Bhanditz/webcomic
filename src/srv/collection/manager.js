!function(){"use strict";!function t(){function e(t,e,a){var i=document.querySelector('[name="'+t.getAttribute("data-input")+'"]'),o=new FormData,r=new XMLHttpRequest,c=i.value.split(",");i.value=e.toString(),c.toString()!==e.toString()&&i.dispatchEvent(new Event("change",{bubbles:!0})),o.append("action","webcomic_update_media_manager"),o.append("media",e),r.onreadystatechange=function(){4===r.readyState&&n(t,e,a,JSON.parse(r.responseText))},r.open("POST",ajaxurl),r.send(o)}function n(t,n,c,d){t.innerHTML="";for(var u=0;u<d.length;u++)t.innerHTML+=a(d[u].id,d[u].media);t.innerHTML+=i(d,c),c&&o(t,c),t.querySelector("button").addEventListener("click",function(){r(t,c)});for(var s=t.querySelectorAll("a"),l=0;l<s.length;l++)!function(a){s[a].addEventListener("click",function(i){i.preventDefault();var o=n.indexOf(Number(s[a].parentNode.getAttribute("data-id")));console.log(o),n.splice(o,1),e(t,n,c)})}(l)}function a(t,e){return'\n\t\t\t<div data-id="'+t+'">\n\t\t\t\t'+e+'\n\t\t\t\t<a class="dashicons dashicons-no" style="cursor:pointer">\n\t\t\t\t\t<span class="screen-reader-text">'+webcomicMediaManagerL10n.remove+"</span>\n\t\t\t\t</a>\n\t\t\t</div>"}function i(t,e){var n="dashicons-format-image",a=webcomicMediaManagerL10n.add,i="";return e&&(n="dashicons-images-alt2"),t.length&&(a=webcomicMediaManagerL10n.change),i='\n\t\t\t<p>\n\t\t\t\t<button type="button" class="button button-large">\n\t\t\t\t\t<span class="dashicons '+n+'"></span> '+a+"\n\t\t\t\t</button>\n\t\t\t</p>",1<t.length&&e&&(i+='<p class="description">'+webcomicMediaManagerL10n.drag+"</p>"),i}function o(t,n){jQuery(t).sortable({items:"div",start:function(t,e){e.placeholder.height(e.helper.outerHeight())},stop:function(){e(t,jQuery(t).sortable("toArray",{attribute:"data-id"}),n)}})}function r(t,n){wp.media.frames.webcomicMedia=wp.media({title:webcomicMediaManagerL10n.title,button:{text:webcomicMediaManagerL10n.update},library:{type:"image"},multiple:n}).on("select",function(){for(var a=[],i=wp.media.frames.webcomicMedia.state().get("selection"),o=0;o<i.length;o++)a.push(i.models[o].id);e(t,a,n)}).open()}if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",t);for(var c=document.querySelectorAll("[data-webcomic-media-manager]"),d=0;d<c.length;d++)e(c[d],document.querySelector('[name="'+c[d].getAttribute("data-input")+'"]').value.split(","),Boolean(c[d].getAttribute("data-webcomic-media-manager")));jQuery(document).on("widget-added widget-updated",function(t,n){if(n[0].id.match(/_mgsisk_webcomic_/))for(var a=n[0].querySelectorAll("[data-webcomic-media-manager]"),i=0;i<a.length;i++)e(a[i],document.querySelector('[name="'+a[i].getAttribute("data-input")+'"]').value.split(","),Boolean(a[i].getAttribute("data-webcomic-media-manager")))})}()}();
